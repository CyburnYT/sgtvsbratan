<!-- Ersetze den gesamten Script-Teil mit diesem aktualisierten Code -->
<script>
    // Game State
    let gameState = {
        tournament: null,
        viewers: [],
        teamBratan: [],
        teamSgt: [],
        currentBattle: null,
        bracket: [],
        currentRound: 0,
        punishments: [],
        isLoggedIn: false,
        isAdmin: false,
        tournamentStarted: false,
        captains: {
            bratan: null,
            sgt: null
        }
    };

    // API Helper
    async function fetchData(action, data = {}) {
        const response = await fetch(`api.php?action=${action}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        return await response.json();
    }

    // Login System
    async function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        try {
            const result = await fetchData('login', { username, password });
            
            if (result.success) {
                gameState.isLoggedIn = true;
                gameState.isAdmin = result.is_admin;
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                document.getElementById('loginError').style.display = 'none';
                
                // Load tournament data
                await loadTournamentData();
            } else {
                document.getElementById('loginError').textContent = result.error || 'Invalid credentials!';
                document.getElementById('loginError').style.display = 'block';
            }
        } catch (error) {
            console.error('Login error:', error);
            document.getElementById('loginError').textContent = 'Login failed. Please try again.';
            document.getElementById('loginError').style.display = 'block';
        }
    }

    async function loadTournamentData() {
        try {
            const data = await fetchData('get_tournament');
            
            if (data.error) {
                console.error(data.error);
                return;
            }
            
            gameState.tournament = data.tournament;
            gameState.viewers = data.players.filter(p => !p.team);
            gameState.teamBratan = data.players.filter(p => p.team === 'bratan');
            gameState.teamSgt = data.players.filter(p => p.team === 'sgt');
            gameState.bracket = data.matches;
            gameState.punishments = data.punishments;
            gameState.currentRound = data.current_round || 0;
            gameState.tournamentStarted = gameState.bracket.length > 0;
            
            // Update UI
            updateViewerPool();
            updateTeamDisplays();
            updateBracketDisplay();
            updatePunishmentList();
            
            if (gameState.tournamentStarted) {
                // Hide setup elements
                document.getElementById('teamSize').style.display = 'none';
                document.querySelector('#setup button[onclick="generateTeamSlots()"]').style.display = 'none';
                document.getElementById('viewerName').style.display = 'none';
                document.getElementById('viewerSlot').style.display = 'none';
                document.getElementById('addViewerBtn').style.display = 'none';
                document.getElementById('randomDrawBtn').style.display = 'none';
                document.getElementById('startTournamentBtn').style.display = 'none';
                
                // Change viewer pool title
                const viewerPoolTitle = document.querySelector('.viewer-pool h3');
                if (viewerPoolTitle) {
                    viewerPoolTitle.textContent = 'Active Players - Edit Slots';
                }
                
                // Hide viewer pool
                document.getElementById('viewerPool').style.display = 'none';
                
                // Set current battle
                const currentBattles = gameState.bracket.filter(b => 
                    b.round === gameState.currentRound && !b.winner
                );
                
                if (currentBattles.length > 0) {
                    gameState.currentBattle = currentBattles[0];
                    updateBattleDisplay();
                }
            }
        } catch (error) {
            console.error('Error loading tournament data:', error);
        }
    }

    // Rest des Codes mit fetchData() Aufrufen anstelle von direkten Ã„nderungen...
</script>
